---
title: "Applied Multivariate Statistical Analysis"
subtitle: "Exercise 2"
author: "Kasper Veje Jakobsen (<kasja20@student.sdu.dk>)"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: false
    code_folding: show
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(st514)
```

# Exercise 1.4

This exercise uses data on the world's 10 largest companies, including sales, profits, and assets (in billions).

## Part (a)
Plot the scatter diagram and marginal dot diagrams for variables x1 (sales) and x2 (profits), then comment on the appearance of the diagrams.

```{r ex1-4}
# Load the Forbes data
data("P1-4")

# Create a scatterplot with a marginal dot plot for the variables x1 and x2
marginal.dot.plot(tbl$V1, tbl$V2, xlab = expression("x"[1]), ylab = expression("x"[2]))
```

The scatter plot shows a positive relationship between sales and profits. Companies with higher sales tend to have higher profits. The marginal dot plots show the distribution of each variable, with some companies having notably higher sales and profits than others.

## Part (b)
Compute the mean of x1 and x2, variances s11 and s22, covariance s12, and correlation coefficient r12. Then interpret r12.

```{r ex1-4b}
# Mean of x1
mean(tbl$V1)

# Mean of x2
mean(tbl$V2)

# Variance of x1 (using n divisor)
var(tbl$V1) * (nrow(tbl) - 1) / nrow(tbl)

# Variance of x2 (using n divisor)
var(tbl$V2) * (nrow(tbl) - 1) / nrow(tbl)

# Covariance between x1 and x2 (using n divisor)
cov(tbl$V1, tbl$V2) * (nrow(tbl) - 1) / nrow(tbl)

# Correlation between x1 and x2
cor(tbl$V1, tbl$V2)
```

**Interpretation of r12:**

The correlation coefficient r12 is approximately 0.69, indicating a strong positive linear relationship between sales and profits. This means that companies with higher sales tend to have higher profits.

# Exercise 1.5

Use the data in Exercise 1.4 to complete the following tasks.

## Part (a)
Plot the scatter diagrams and dot diagrams for (x2, x3) and (x1, x3), then comment on the patterns.

```{r ex1-5a}
# Load Forbes data
data("P1-4")

# Create a scatterplot with a marginal dot plot for the variables x2 and x3
marginal.dot.plot(tbl$V2, tbl$V3, xlab = expression("x"[2]), ylab = expression("x"[3]))

# Create a scatterplot with a marginal dot plot for the variables x1 and x3
marginal.dot.plot(tbl$V1, tbl$V3, xlab = expression("x"[1]), ylab = expression("x"[3]))
```

**Comments on the patterns:**

1. For (x2, x3) - Profits vs. Assets:
   - There is no clear linear relationship between profits and assets.

2. For (x1, x3) - Sales vs. Assets:
   - There seem to be a negative relationship between sales and assets.

## Part (b)
Compute the x̄, Sn, and R arrays for (x1, x2, x3).

```{r ex1-5b}
# Mean vector
cat("Mean vector:\n")
print(round(colMeans(tbl),2))

# Variance-covariance matrix (using n divisor)
cat("\nVariance-covariance matrix:\n")
print(round(cov(tbl) * (nrow(tbl) - 1) / nrow(tbl)),2)

# Correlation matrix
cat("\nCorrelation matrix:\n")
print(cor(tbl))
```

# Exercise 1.8

This exercise asks us to calculate distances between points using different distance formulas.

Evaluate the distance of the point P = (-1, -1) to the point Q = (1, 0) using:
- The Euclidean distance formula with p = 2
- The statistical distance with a11 = 1/3, a22 = 4/27, and a12 = 1/9

```{r ex1-8}
# Calculate the Euclidean distance
euclid_distance <- sqrt((-1 - 1)^2 + (-1 - 0)^2)
print(euclid_distance)

# Calculate the statistical distance
stat_distance <- sqrt(1/3 * (-1 - 1)^2 + 2/9 * (-1 - 1) * (-1 - 0) + 4/27 * (-1 - 0)^2)
print(stat_distance)
```

# Exercise 1.14

This exercise uses data related to multiple sclerosis (MS) responses to visual stimuli.

## Part (a)
Plot the two-dimensional scatter diagram for the variables X2 (total response to stimulus S1) and X4 (total response to stimulus S2) for the multiple-sclerosis group.

```{r ex1-14a}
rm(list=ls())
# Load multiple-sclerosis data
data("T1-6")

# Inspect data
str(tbl)

# Extract MS group data
ms <- subset(tbl, V6 == 1)

# Scatterplot of X4 versus X2
plot(ms$V2, ms$V4, xlab = expression("X"[2]), ylab = expression("X"[4]))
```

**Comments on the diagram:**

The scatter plot shows a strong positive relationship between responses to stimulus S1 (X2) and stimulus S2 (X4) in the MS group. Patients who have a higher response to S1 also tend to have a higher response to S2.

## Part (b)
Compute the x̄, Sn, and R arrays for the non-multiple-sclerosis and multiple-sclerosis groups separately.

```{r ex1-14b}
# Separate non-MS group and MS group
nms <- subset(tbl, V6 == 0)

# Non-MS group statistics
cat("Non-MS Group - Mean vector:\n")
print(colMeans(nms[1:5]))

cat("\nNon-MS Group - Variance-covariance matrix:\n")
print(cov(nms[1:5]) * (nrow(nms[1:5]) - 1) / nrow(nms[1:5]))

cat("\nNon-MS Group - Correlation matrix:\n")
print(cor(nms[1:5]))

# MS group statistics
cat("\nMS Group - Mean vector:\n")
print(colMeans(ms[1:5]))

cat("\nMS Group - Variance-covariance matrix:\n")
print(cov(ms[1:5]) * (nrow(ms[1:5]) - 1) / nrow(ms[1:5]))

cat("\nMS Group - Correlation matrix:\n")
print(cor(ms[1:5]))
```

# Exercise 1.17

This exercise involves analyzing national track records for women across different countries.

```{r ex1-17}
# Clean
rm(list=ls())

# Load national-track-records data
data("T1-9")
ntr <- tbl

# Add column names
colnames(ntr) <- c("Country", "100m", "200m", "400m", "800m", "1500m", "3000m", "Marathon")

# Calculate in minutes
ntr$`100m` <- ntr$`100m` / 60
ntr$`200m` <- ntr$`200m` / 60
ntr$`400m` <- ntr$`400m` / 60

# Calculate mean vector
print(colMeans(ntr[2:8]))

# Calculate variance-covariance matrix
print(cov(ntr[2:8]) * (nrow(ntr[2:8]) - 1) / nrow(ntr[2:8]))

# Calculate correlation matrix
print(cor(ntr[2:8]))
```

# Exercise 1.18

Convert the national track records for women to speeds measured in meters per second, then compute the x̄, Sn, and R arrays.

```{r ex1-18}
# Convert times to speeds
data("T1-9")
speed_tbl <- tbl
colnames(speed_tbl) <- c("Country", "100m", "200m", "400m", "800m", "1500m", "3000m", "Marathon")
print(cor(speed_tbl[2:8]))

speed_tbl$`100m` <- 100 / (speed_tbl$`100m`)  # 100m
speed_tbl$`200m` <- 200 / (speed_tbl$`200m`)  # 200m
speed_tbl$`400m` <- 400 / (speed_tbl$`400m`)  # 400m
speed_tbl$`800m` <- 800 / (speed_tbl$`800m` * 60)  # 800m
speed_tbl$`1500m` <- 1500 / (speed_tbl$`1500m` * 60)  # 1500m
speed_tbl$`3000m` <- 3000 / (speed_tbl$`3000m` * 60)  # 3000m
speed_tbl$`Marathon` <- 42195 / (speed_tbl$`Marathon` * 60)  # Marathon

print(cor(speed_tbl[2:8]))

# Calculate mean vector
print(colMeans(speed_tbl[2:8]))

# Calculate variance-covariance matrix
print(cov(speed_tbl[2:8]) * (nrow(speed_tbl[2:8]) - 1) / nrow(speed_tbl[2:8]))

# Calculate correlation matrix
print(cor(speed_tbl[2:8]))
```

**Comparison with Exercise 1.17:**

The correlation matrices for times and speeds are identical. This is because converting from time to speed is a monotonic transformation that preserves the rank order of the data. Correlation measures are invariant to such transformations.

# Exercise 1.19

Create the scatter plot and boxplot displays for the mineral-content data and the national track records data.

```{r ex1-19a}
# Load mineral content data
data("T1-8")

# Create a matrix of scatterplots with boxplots on the main diagonal
pairs(tbl, diag.panel = panel.boxplot, labels = "")
```


```{r ex1-19b}
# Create a matrix of scatterplots with boxplots on the main diagonal
pairs(speed_tbl[2:8], diag.panel = panel.boxplot, labels = "")
```

This matrix plot shows scatter plots of each pair of variables in the off-diagonal positions and boxplots of each variable on the diagonal. It allows us to examine relationships between different track events and the distribution of each variable.

# Exercise 1.27

This exercise explores the relationship between national park size and visitor numbers.

## Part (a)
Create a scatter plot and calculate the correlation coefficient.

```{r ex1-27a}
rm(list=ls())
# Load national parks data
data("T1-11")

park <- tbl
colnames(park) <- c("size", "visitors")

# Scatterplot of visitors versus size
plot(park$size, park$visitors, xlab = "Size", ylab = "Visitors")

# Calculate correlation coefficient
cat("Correlation coefficient:", cor(park$size, park$visitors), "\n")
```

## Part (b)
Identify the park that is unusual, drop this point, and recalculate the correlation coefficient.

```{r ex1-27b}
# Remove Great Smoky (observation 7) from the data frame
park_filtered <- park[-7, ]

# Calculate correlation coefficient without Great Smoky
cat("Correlation coefficient without Great Smoky:", cor(park_filtered$size, park_filtered$visitors), "\n")
```

**Comments on the effect of this point:**

After removing Great Smoky Mountains National Park (observation 7), the correlation coefficient changes significantly. This demonstrates the sensitivity of correlation coefficients to outliers or influential observations.

## Part (c)
Would the correlation in Part b change if you measure size in square miles instead of acres?

```{r ex1-27c}
# Convert acres to square miles (1 acre = 1/640 square mile)
park$size_sqmiles <- park$size / 640
park_filtered$size_sqmiles <- park_filtered$size / 640

# Calculate correlation with square miles
cat("Correlation coefficient using square miles:", cor(park$size_sqmiles, park$visitors), "\n")
cat("Correlation coefficient without Great Smoky using square miles:", 
    cor(park_filtered$size_sqmiles, park_filtered$visitors), "\n")
```

The correlation coefficients remain exactly the same when we change the unit of measurement from acres to square miles. This is because correlation is calculated based on standardized values (z-scores), which removes the effect of the scale of measurement. Linear transformations preserve the correlation coefficient.