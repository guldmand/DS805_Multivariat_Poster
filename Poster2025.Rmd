---
title: "Poster"
author: "Jannik Guldmand"
date: "2025-05-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Poster project

## Data: Load data
```{r}
library(st514)
# Indl√¶sning af data
data("T6-19")
T6.19 <- tbl
T6.19
```



## Data: update factorial strings
```{r}
colnames(T6.19) <- c("Snude vent l√¶ngde (cm)", "V√¶gt (kg)", "K√∏n")
levels(T6.19$K√∏n) <- c("Hun", "Han")
T6.19
```

## Data: Working with the data
```{r}
mean(T6.19$"Snude vent l√¶ngde (cm)")
```
```{r}
mean(T6.19$"V√¶gt (kg)")
```

```{r}
# Variance of x1 (using n divisor)
var(T6.19$"Snude vent l√¶ngde (cm)") * (nrow(T6.19) - 1) / nrow(T6.19)
```
```{r}
# Variance of x2 (using n divisor)
var(T6.19$"V√¶gt (kg)") * (nrow(T6.19) - 1) / nrow(T6.19)
```

```{r}
# Covariance between x1 and x2 (using n divisor)
cov(T6.19$"Snude vent l√¶ngde (cm)", T6.19$"V√¶gt (kg)") * (nrow(T6.19) - 1) / nrow(T6.19)
```

```{r}
# Correlation between x1 and x2
cor(T6.19$"Snude vent l√¶ngde (cm)", T6.19$"V√¶gt (kg)")
```








```{r}
# Create a scatterplot with a marginal dot plot for the variables x1 and x2
marginal.dot.plot(T6.19$"Snude vent l√¶ngde (cm)", T6.19$"V√¶gt (kg)", xlab = expression("Snude vent l√¶ngde (cm) x"[1]), ylab = expression("V√¶gt (kg) x"[2]))
```
```{r}
# Variance-covariance matrix:

#create t6.19 nuerical withouht column K√∏n
T6.19_numerical <- T6.19[, 1:2]

#print(round(cov(T6.19_numerical) * (nrow(T6.19) - 1) / nrow(T6.19)),3)
print(round(cov(T6.19_numerical) * (nrow(T6.19) - 1) / nrow(T6.19), digits=3))

```


```{r}
# Find standardafvigelser (kvadratrod af diagonale v√¶rdier i varians-kovarians-matrixen)
vcov_matrix <- cov(T6.19_numerical) * (nrow(T6.19) - 1) / nrow(T6.19)

# Tr√¶k diagonalen ud (varians for hver variabel), og tag kvadratroden
std_devs <- sqrt(diag(vcov_matrix))

# Udskriv med beskrivende tekst
cat("Standardafvigelser (‚àövarians):\n")
print(round(std_devs, 2))
```






## DATA: Explanatory Data Analysis


```{r}
# Dimensioner
dim(T6.19)
```
56 observations and  3 variables


```{r}
#Variabeltyper
str(T6.19)
```


```{r}
#Sammendrag
summary(T6.19)
```

# EDA: S√∏jlediagram

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)

# Tilf√∏j et unikt ID til hver observation
T6.19_obs <- T6.19 %>%
  mutate(Obs = paste0("Obs", row_number()))

# G√∏r dataen lang for Snout og V√¶gt
T6.19_long <- T6.19_obs %>%
  dplyr::select(`Obs`, `K√∏n`, `Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`) %>%
  pivot_longer(cols = c(`Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`),
               names_to = "Variable", values_to = "Value")

# Standardiser variabelnavne lidt for p√¶nere labels
library(stringr)

T6.19_long$Variable <- str_replace_all(T6.19_long$Variable,
                                       c("Snout Vent Length \\(cm\\)" = "Snout Length",
                                         "V√¶gt \\(kg\\)" = "V√¶gt"))

# Plot: Hver s√∏jle er √©n observation
ggplot(T6.19_long, aes(x = Obs, y = Value, fill = K√∏n)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ Variable, scales = "free_y") +
  labs(
    title = "Snout Length og V√¶gt for alle observationer",
    x = "Observationer", y = "V√¶rdi"
  ) +
  scale_fill_manual(values = c("Han" = "#F8766D", "Hun" = "#619CFF")) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())


```

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)

# Tilf√∏j numerisk ID og behold som karakter for r√¶kkef√∏lge
T6.19_obs <- T6.19 %>%
  mutate(Obs = row_number())

# G√∏r data lang
T6.19_long <- T6.19_obs %>%
  dplyr::select(Obs, K√∏n, `Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`) %>%
  pivot_longer(cols = c(`Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`),
               names_to = "Variable", values_to = "Value")

# Standardiser navne
T6.19_long$Variable <- str_replace_all(T6.19_long$Variable,
                                       c("Snout Vent Length \\(cm\\)" = "Snout Length",
                                         "V√¶gt \\(kg\\)" = "V√¶gt"))

# G√∏r Obs til faktor for r√¶kkef√∏lge
T6.19_long$Obs <- factor(T6.19_long$Obs, levels = 1:56)

# Kombiner observation og variabel til unik bar (bruges ikke i plot her men gemmes til evt. brug)
T6.19_long$ObsVar <- interaction(T6.19_long$Obs, T6.19_long$Variable, sep = "_")

# Plot begge variabler som separate s√∏jler i √©t diagram
ggplot(T6.19_long, aes(x = Obs, y = Value, fill = K√∏n)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.9), aes(group = Variable)) +
  labs(
    title = "Snude Veent L√¶ngde og V√¶gt pr. observation",
    x = "Observation", y = "V√¶rdi"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```




```{r}
library(dplyr)
library(tidyr)
library(ggplot2)

# Beregn gennemsnit for hver kombination af variabel og k√∏n
T6.19_means <- T6.19 %>%
  group_by(K√∏n) %>%
  summarise(
    Snout = mean(`Snude vent l√¶ngde (cm)`),
    V√¶gt = mean(`V√¶gt (kg)`)
  ) %>%
  pivot_longer(cols = c(Snout, V√¶gt), names_to = "Variable", values_to = "Mean")

# Plot
ggplot(T6.19_means, aes(x = K√∏n, y = Mean, fill = Variable)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Gennemsnitlig Snude vent l√¶ngde og V√¶gt fordelt p√• k√∏n",
    x = "K√∏n", y = "Gennemsnitlig v√¶rdi"
  ) +
  scale_fill_manual(values = c("Snout" = "#619CFF", "V√¶gt" = "#F8766D")) +
  theme_minimal()

```





```{r}
# Scatterplot of length and V√¶gt given K√∏n=Hun

## Scatterplot: Huns only
T6.19_Hun <- subset(T6.19, K√∏n == "Hun")

plot(T6.19_Hun$`Snude vent l√¶ngde (cm)`, T6.19_Hun$`V√¶gt (kg)`,
     xlab = expression("Snude vent l√¶ngde (cm) x"[1]),
     ylab = expression("V√¶gt (kg) x"[2]),
     main = "Scatterplot of Hun-anakondaerne",
     pch = 19, col = "darkred")

```

```{r}
## Scatterplot: Hans only
T6.19_Han <- subset(T6.19, K√∏n == "Han")

plot(T6.19_Han$`Snude vent l√¶ngde (cm)`, T6.19_Han$`V√¶gt (kg)`,
     xlab = expression("Snude vent l√¶ngde (cm) x"[1]),
     ylab = expression("V√¶gt (kg) x"[2]),
     main = "Scatterplot of Han-anakondaerne",
     pch = 19, col = "darkblue")

```

```{r}

plot(T6.19$`Snude vent l√¶ngde (cm)`, T6.19$`V√¶gt (kg)`,
     xlab = expression("Snude vent l√¶ngde (cm) x"[1]),
     ylab = expression("V√¶gt (kg) x"[2]),
     #xlim = c(0, 500),
     #ylim = c(0, 100),
     main = "Scatterplot med stikpr√∏vegennemsnit",
     pch = 16,
     col = ifelse(T6.19$K√∏n == "Hun", "red", "lightblue"))

grid()

T6.19_Hun <- subset(T6.19, K√∏n == "Hun")
T6.19_Hun_numerical <- T6.19_Hun[, 1:2]
print(colMeans(T6.19_Hun_numerical, na.rm = TRUE), digits = 5)

T6.19_Han <- subset(T6.19, K√∏n == "Han")
T6.19_Han_numerical <- T6.19_Han[, 1:2]
print(colMeans(T6.19_Han_numerical, na.rm = TRUE), digits = 5)



# Beregning af stikpr√∏vegennemsnit
x_bar <- colMeans(T6.19_numerical)
HunBar <- colMeans(T6.19_Hun_numerical, na.rm = TRUE)
HanBar <- colMeans(T6.19_Han_numerical, na.rm = TRUE)
#x_bar


# Tilf√∏j stikpr√∏vegennemsnit til plot
points(x_bar[1], x_bar[2], pch = "X", col = "black", cex = 2)
points(HunBar[1], HunBar[2], pch = 15, col = "black", cex = 2)
points(HanBar[1], HanBar[2], pch = 17, col = "black", cex = 2)

text(x_bar[1], x_bar[2],
     labels = paste0(" (", round(x_bar[1], 2), " cm, ", round(x_bar[2], 2), " kg)"),
     pos = 4, cex = 0.9)

text(HunBar[1], HunBar[2],
     labels = paste0(" (", round(HunBar[1], 2), " cm, ", round(HunBar[2], 2), " kg)"),
     pos = 4, cex = 0.9)

text(HanBar[1], HanBar[2],
     labels = paste0(" (", round(HanBar[1], 2), " cm, ", round(HanBar[2], 2), " kg)"),
     pos = 4, cex = 0.9)




legend("topleft", legend = c("56 Observationer:", "Han", "Hun", "Stikpr√∏vegennemsnit", "Han stikpr√∏vegennemsnit", "Hun stikpr√∏vegennemsnit"),
       col = c("black", "lightblue", "red", "black","black","black"),pch = c(NA, 19, 19, 4, 17, 15),
       pt.lwd = c(1,1,1,3, 3, 3))



```

```{r}
#Mean vector
print(colMeans(T6.19_numerical, na.rm = TRUE), digits = 5)
```

```{r}
# colMeans of T6.19 where K√∏n=Hun
# Column means for Huns
T6.19_Hun <- subset(T6.19, K√∏n == "Hun")
T6.19_Hun_numerical <- T6.19_Hun[, 1:2]
print(colMeans(T6.19_Hun_numerical, na.rm = TRUE), digits = 5)

#HunBar <- colMeans(T6.19_Hun_numerical, na.rm = TRUE)

```


```{r}
# colMeans of T6.19 where K√∏n=Han
# Column means for Hans
T6.19_Han <- subset(T6.19, K√∏n == "Han")
T6.19_Han_numerical <- T6.19_Han[, 1:2]
print(colMeans(T6.19_Han_numerical, na.rm = TRUE), digits = 5)

#HanBar <- colMeans(T6.19_Han_numerical, na.rm = TRUE)

```



```{r}
#correlation matrix
print(cor(T6.19_numerical))
```


# Pairsplot
```{r}
pairs(T6.19[, 1:2], 
      main = "Scatterplot Matrix: Snude vent l√¶ngde and V√¶gt",
      pch = 21,
      bg = c("lightpink", "lightblue")[T6.19$K√∏n])

```


```{r}
#pairs(T6.19_numerical, diag.panel = panel.boxplot, labels = "")
pairs(T6.19_numerical,
      diag.panel = panel.boxplot,
      labels = c("Snude vent l√¶ngde", "V√¶gt"),
      main = "Scatterplot Matrix: Snude vent l√¶ngde and V√¶gt")

```
```{r}
# Calculate correlation coefficient
cat("Correlation coefficient:", cor(T6.19$"Snude vent l√¶ngde (cm)", T6.19$"V√¶gt (kg)"), "\n")

```


```{r}
# Calculate correlation coefficient
cat("Correlation coefficient:", cor(T6.19$"V√¶gt (kg)", T6.19$"Snude vent l√¶ngde (cm)"), "\n")
```



```{r}
# Plot af data
plot(T6.19_numerical,
     xlim = c(0, 500),
     ylim = c(0, 100),
     main = "Scatterplot med stikpr√∏vegennemsnit",
     xlab = "Snude vent l√¶ngde (cm) x1", ylab = "V√¶gt (kg) x2", pch = 16)

grid()


# Beregning af stikpr√∏vegennemsnit
x_bar <- colMeans(T6.19_numerical)
#x_bar


# Tilf√∏j stikpr√∏vegennemsnit til plot
points(x_bar[1], x_bar[2], pch = "X", col = "red", cex = 2)

# Tilf√∏j en forklaring
legend("topleft", 
       legend = c("56 Observationer", "Stikpr√∏vegennemsnit"),
       pch = c(16, 4), 
       col = c("black", "red"),
       pt.lwd = c(1, 3))



```

```{r}
# Vis stikpr√∏vegennemsnittet
cat("Stikpr√∏vegennemsnittet er:", x_bar, "\n")
```






```{r}
# Udtr√¶k data
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]
n1 <- nrow(Xf); n2 <- nrow(Xm)
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)
diff_mean <- xbar1 - xbar2

# Pooled kovariansmatrix
S1 <- cov(Xf); S2 <- cov(Xm)
Spooled <- ((n1 - 1)*S1 + (n2 - 1)*S2)/(n1 + n2 - 2)

# Egenv√¶rdier og egenvektorer
eig <- eigen(Spooled)
lambda <- eig$values      # egenv√¶rdier
vectors <- eig$vectors    # egenvektorer

# Parametre for ellipse
alpha <- 0.05
p <- 2
n <- (n1 * n2) / (n1 + n2)
T2_crit <- ((n1 + n2 - 2) * p / (n1 + n2 - p - 1)) * qf(1 - alpha, p, n1 + n2 - p - 1)

# Gener√©r ellipsepunkter
theta <- seq(0, 2*pi, length = 100)
circle <- rbind(cos(theta), sin(theta))
scaling <- sqrt(T2_crit / n) * sqrt(lambda)
ellipse_points <- t(vectors %*% diag(scaling) %*% circle + diff_mean)

# Plot
plot(ellipse_points, type = "l", asp = 1, lwd = 2,
     xlab = "Snude vent l√¶ngde (cm)", ylab = "V√¶gt (kg)",
     main = "Hotelling‚Äôs T¬≤ Ellipse (uden ellipse-pakke)")
points(0, 0, pch = 4, col = "red")
text(0, 0, "0", pos = 1, cex = 0.8)
points(diff_mean[1], diff_mean[2], pch = 19, col = "blue")
text(diff_mean[1], diff_mean[2], "M1 - M2", pos = 4, cex = 0.8)

```


```{r}
# Beregn generaliseret stikpr√∏vevarians for Spooled matrix
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]
n1 <- nrow(Xf); n2 <- nrow(Xm)
S1 <- cov(Xf); S2 <- cov(Xm)
Spooled <- ((n1 - 1)*S1 + (n2 - 1)*S2)/(n1 + n2 - 2)

# Determinant = generaliseret varians
gen_var <- det(Spooled)
cat("Generaliseret stikpr√∏vevarians (|S|):", round(gen_var, 2))

```



## Test for normalitet (f√∏r hypotesetests)
1.1 Univariate normalitetstest (marginal):

    Brug Q‚ÄìQ plot for hver af de to variable (Snout Vent Length og V√¶gt).

    F.eks. som i √òvelse 5.4.B.

1.2 Multivariat normalitetstest:

    Brug Q‚ÄìQ plot for Mahalanobis afstande mod kvantilfunktion for œá¬≤ (chi-square plot).

    F.eks. baseret p√• procedure i bogens Kapitel 4, Ex. 4.13 og Resultat 4.7
    
    
```{r}
# Lav Q-Q plots for hver af de tre variable
par(mfrow = c(2, 2))

for (i in 1:p) {
  qqnorm(T6.19_numerical[,i], 
       main = colnames(T6.19_numerical)[i],
       ylab = "Observerede kvantiler",
       xlab = "Teoretiske kvantiler")
  qqline(T6.19_numerical[,i], col = "red", lwd = 2)
}

# Beregn Mahalanobis-afstandene
Sx <- cov(T6.19_numerical)
D2 <- mahalanobis(T6.19_numerical, colMeans(T6.19_numerical), Sx)

```
```{r}
# Lav et chi-i-anden Q-Q plot for multivariate normalitet
qqplot(qchisq(ppoints(n, a = 0.5), df = p), D2,
       ylab = "Mahalanobis afstande",
       xlab = bquote("Kvantiler af " ~ chi[.(p)]^2))

abline(0, 1, col = "red", lwd = 2)

title(main = "Mahalanobis D¬≤", font.main = 2)
```


    
    
```{r}
library(MASS)
library(car) # til powerTransform

# Antal observationer og dimensioner
n <- nrow(T6.19_numerical)
p <- ncol(T6.19_numerical)

# Box-Cox transformationer
pt_result <- powerTransform(T6.19_numerical)
lambda_vec <- pt_result$lambda
print(lambda_vec)

# Transformer hver variabel
T6.19_transformed <- as.data.frame(
  sapply(1:p, function(i) {
    lambda <- lambda_vec[i]
    x <- T6.19_numerical[, i]
    if (lambda == 0) log(x) else (x^lambda - 1) / lambda
  })
)
colnames(T6.19_transformed) <- colnames(T6.19_numerical)

# Plot QQ-plots for de transformerede variable
par(mfrow = c(2, 2))
for (i in 1:p) {
  qqnorm(T6.19_transformed[, i], 
         main = paste("Q-Q plot (transformeret):", colnames(T6.19_transformed)[i]))
  qqline(T6.19_transformed[, i])
}

# Mahalanobis-afstande (baseret p√• transformerede data)
Sx <- cov(T6.19_transformed)
D2 <- mahalanobis(T6.19_transformed, colMeans(T6.19_transformed), Sx)

# Q-Q plot af Mahalanobis afstande vs. chi^2
qqplot(qchisq(ppoints(n, a = 0.5), df = p), D2,
       ylab = expression("Mahalanobis afstande"),
       xlab = bquote("Kvantiler af " ~ chi[.(p)]^2),
       main = bquote("Q-Q plot af Mahalanobis" * ~ D^2 * " (transformeret)"))
abline(0, 1)
 
```
    
    
    

.



## 2. Univariate inferens (T-tests)
## 2. Univariate analyser

* **T-test** for:

```{r}
# Univariate t-tests for Snout Vent Length og V√¶gt mod K√∏n

# Antag at k√∏n er korrekt kodet som faktor med levels: Hun, Han
T6.19$K√∏n <- factor(T6.19$K√∏n, levels = c("Hun", "Han"))

```


  * l√¶ngde vs. k√∏n
```{r}
# T-test for Snude vent l√¶ngde (cm) mellem k√∏n
t_snout <- t.test(`Snude vent l√¶ngde (cm)` ~ K√∏n, data = T6.19, var.equal = TRUE)

#var.equal = TRUE bruges her i tr√•d med foruds√¶tningen fra tidligere √∏velser, hvor vi antager lig varians ved sammenligninger af grupper.


print(t_snout)
```
  ‚úÖ Korrekt fortolkning:

    H‚ÇÄ (nulhypotese): Der er ingen forskel i gennemsnitlig snout length mellem han- og hun-anacondaer.

    H‚ÇÅ (alternativ hypotese): Der er en forskel i gennemsnitlig snout length mellem k√∏nnene.

üìå Resultat:

    P-v√¶rdien er ekstremt lille (‚âà 5.98e-12), dvs. langt under den typiske signifikansgr√¶nse (Œ± = 0.05).

    Derfor forkaster vi H‚ÇÄ: Der er statistisk evidens for, at snout length afh√¶nger af k√∏n.

    Konfidensintervallet [92.17, 146.88][92.17, 146.88] indeholder ikke nul, hvilket styrker denne konklusion.

    Hun-anacondaer (‚ôÄ) har i gennemsnit ca. 120 cm l√¶ngere snout end hanner (‚ôÇ).

‚ùó Korrigeret fortolkning:

    "Da p-v√¶rdien er meget lav (<< 0.05), forkastes H‚ÇÄ. Der er alts√• en statistisk signifikant forskel i snout length mellem hun- og han-anacondaer. Det tyder p√•, at snout length afh√¶nger af k√∏n."

üí• OBS: Din formulering ‚ÄúH0 hypotesen ikke forkastes baseret p√• lav p-v√¶rdi‚Äù er forkert ‚Äî lav p-v√¶rdi betyder netop, at vi forkaster H‚ÇÄ.
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  * v√¶gt vs. k√∏n
```{r}
# T-test for V√¶gt (kg) mellem k√∏n
t_V√¶gt <- t.test(`V√¶gt (kg)` ~ K√∏n, data = T6.19, var.equal = TRUE)

#var.equal = TRUE bruges her i tr√•d med foruds√¶tningen fra tidligere √∏velser, hvor vi antager lig varians ved sammenligninger af grupper.


print(t_V√¶gt)
```
  
  
  
  
  
  
  
  
  
  
  ‚úÖ Korrekt fortolkning:

    H‚ÇÄ (nulhypotese): Der er ingen forskel i gennemsnitlig v√¶gt mellem k√∏nnene.

    H‚ÇÅ (alternativ hypotese): Der er forskel i gennemsnitlig v√¶gt mellem k√∏nnene.

üìå Resultat:

    P-v√¶rdien er ekstremt lav (‚âà 1.74e-10), alts√• klart under 0.05 ‚Üí forkast H‚ÇÄ.

    Der er statistisk bel√¶g for, at k√∏n har stor betydning for v√¶gt.

    Konfidensintervallet viser, at hunner vejer 22‚Äì38 kg mere end hanner i gennemsnit.

‚ùó Korrigeret fortolkning:

    "P-v√¶rdien er meget lav, hvilket betyder, at vi forkaster H‚ÇÄ. Der er statistisk signifikant forskel i v√¶gt mellem k√∏n. V√¶gten afh√¶nger af k√∏n, og hun-anacondaer vejer gennemsnitligt betydeligt mere."
    
    
    
    
    
    
    
    
    
    
    
    
  (Sammenfatning)
  
  ‚úÖ Samlet konklusion:
  
  Test	p-v√¶rdi	H‚ÇÄ forkastes?	Fortolkning
  Snout Length ~ K√∏n	5.98e-12	Ja	Snout length afh√¶nger af k√∏n
  V√¶gt ~ K√∏n	1.74e-10	Ja	V√¶gt afh√¶nger af k√∏n
    
  
  
  üìä Tabel til posteren (Univariate T-tests)
  
  | **Variabel**      | **Middelv√¶rdi (‚ôÄ)** | **Middelv√¶rdi (‚ôÇ)** | **T-v√¶rdi** | **P-v√¶rdi**      | **95% CI for forskel** | **Konklusion**                        |
  | ----------------- | ------------------- | ------------------- | ----------- | ---------------- | ---------------------- | ------------------------------------- |
  | Snout Length (cm) | 348.28              | 228.75              | 8.76        | < 0.000000000006 | \[92.17, 146.88]       | Signifikant forskel. Afh√¶nger af k√∏n. |
  | V√¶gt (kg)       | 37.26               | 7.29                | 7.85        | < 0.000000000174 | \[22.32, 37.63]        | Signifikant forskel. Afh√¶nger af k√∏n. |

    
    
 üßæ Noter til posteren (fortolkning og forklaring):
 
   Univariate T-tests blev udf√∏rt for hver af de to variable:
  
      Snout Length (cm) og V√¶gt (kg) fordelt p√• k√∏n (‚ôÄ vs ‚ôÇ).
  
      Begge tests viser ekstremt lave p-v√¶rdier (<< 0.05), hvilket betyder, at vi forkaster nulhypotesen.
  
  üü¢ Fortolkning:
  
      Der er statistisk signifikant forskel i b√•de l√¶ngde og v√¶gt mellem hun- og han-anacondaer.
  
      Hun-anacondaer har i gennemsnit 120 cm l√¶ngere snout og 30 kg h√∏jere v√¶gt end hanner.
  
      Disse forskelle er ikke blot statistisk signifikante, men ogs√• biologisk relevante.
      
      
      
üì¶ Boxplots for Snout Length og V√¶gt fordelt p√• k√∏n

```{r}
library(ggplot2)
library(tidyr)
library(dplyr)

# G√∏r data lang
T6.19_long <- T6.19 %>%
  dplyr::select(K√∏n, `Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`) %>%
  pivot_longer(cols = -K√∏n, names_to = "Variable", values_to = "Value")

# Standardiser labels
T6.19_long$Variable <- gsub("Snude vent Length \\(cm\\)", "Snude vent L√¶ngde", T6.19_long$Variable)
T6.19_long$Variable <- gsub("V√¶gt \\(kg\\)", "V√¶gt", T6.19_long$Variable)

# Boxplot
ggplot(T6.19_long, aes(x = K√∏n, y = Value, fill = K√∏n)) +
  geom_boxplot(alpha = 0.7) +
  facet_wrap(~ Variable, scales = "free_y") +
  labs(
    title = "Boxplots af Snude vent l√¶ngde og V√¶gt fordelt p√• k√∏n",
    x = "K√∏n", y = "V√¶rdi"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```

    
    
    
```{r}
# Violinplot
ggplot(T6.19_long, aes(x = K√∏n, y = Value, fill = K√∏n)) +
  geom_violin(trim = FALSE, alpha = 0.6, bw = 10) +  # Juster bw (bandwidth)
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  facet_wrap(~ Variable, scales = "free_y") +
  labs(
    title = "Violinplots af Snude vent l√¶ngde og V√¶gt fordelt p√• k√∏n",
    x = "K√∏n", y = "V√¶rdi"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()


```
    
  
  
```{r}
ggplot(T6.19_long, aes(x = K√∏n, y = Value, fill = K√∏n)) +
  geom_violin(trim = FALSE, scale = "count", alpha = 0.6) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  facet_wrap(~ Variable, scales = "free_y") +
  labs(
    title = "Violinplots af Snude vent l√¶ngde og V√¶gt fordelt p√• k√∏n",
    x = "K√∏n", y = "V√¶rdi"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```
  
  
```{r}
# Violinplot: Snout Length
ggplot(T6.19, aes(x = K√∏n, y = `Snude vent l√¶ngde (cm)`, fill = K√∏n)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  labs(
    title = "Violin Plot: Snude vent l√¶ngde by K√∏n",
    x = "K√∏n", y = "Snude vent l√¶ngde (cm)"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

# Violinplot: V√¶gt
ggplot(T6.19, aes(x = K√∏n, y = `V√¶gt (kg)`, fill = K√∏n)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  labs(
    title = "Violin Plot: V√¶gt by K√∏n",
    x = "K√∏n", y = "V√¶gt (kg)"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```
  
```{r}
# Pakker
library(ggplot2)
library(dplyr)

# Plot 1: Snout Length by K√∏n
ggplot(T6.19, aes(x = K√∏n, y = `Snude vent l√¶ngde (cm)`, fill = K√∏n)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  labs(
    title = "Violin Plot: Snude vent l√¶ngde by K√∏n",
    x = "K√∏n",
    y = "Snude vent l√¶ngde (cm)"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```
  
  
```{r}
# Plot 2: V√¶gt by K√∏n
ggplot(T6.19, aes(x = K√∏n, y = `V√¶gt (kg)`, fill = K√∏n)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  labs(
    title = "Violin Plot: V√¶gt by K√∏n",
    x = "K√∏n",
    y = "V√¶gt (kg)"
  ) +
  scale_fill_manual(values = c("Hun" = "#F8766D", "Han" = "#619CFF")) +
  theme_minimal()

```
  
  
  
  
  
  * Bruges til at supplere konklusionen fra multivariat test
  --------------------------------------------------------------




## 2.B Geometrisk forst√•else af kovarians og korrelation (frivillig sektion)

```{r}
# Udv√¶lg de f√∏rste 3 observationer (uanset k√∏n)
X <- as.matrix(T6.19[1:3, 1:2])  # 3x2 matrix (Snout, V√¶gt)

# Beregn middelvektor (kolonnegennemsnit)
x_bar <- colMeans(X)

# Lav 1-vektor
Ones <- rep(1, nrow(X))

# Beregn afvigelsesmatrix: Y = X - 1 * x_bar^T
Y <- X - Ones %*% t(x_bar)

# Udtr√¶k kolonnerne som vektorer
Y1 <- Y[,1]  # Snout
Y2 <- Y[,2]  # V√¶gt

# Beregn l√¶ngder
Ly1 <- sqrt(sum(Y1^2))
Ly2 <- sqrt(sum(Y2^2))

# Beregn cosinus og vinkel
costh <- sum(Y1 * Y2) / (Ly1 * Ly2)
ang <- acos(costh) * 180 / pi

# Varians, kovarians og korrelation
s11 <- sum(Y1^2) / nrow(X)
s22 <- sum(Y2^2) / nrow(X)
s12 <- sum(Y1 * Y2) / nrow(X)
r12 <- s12 / sqrt(s11 * s22)

# Print resultater
cat("Afvigelsesvektorer for Anaconda-data (f√∏rste 3 r√¶kker):\n\n")
cat("L√¶ngde af afvigelsesvektor Snude vent l√¶ngde:", Ly1, "\n")
cat("L√¶ngde af afvigelsesvektor V√¶gt:", Ly2, "\n")
cat("Cosinus til vinkel mellem vektorer:", costh, "\n")
cat("Vinkel mellem vektorer (grader):", ang, "\n\n")
cat("Varians af Snude vent l√¶ngde:", s11, "\n")
cat("Varians af V√¶gt:", s22, "\n")
cat("Kovarians:", s12, "\n")
cat("Korrelationskoefficient:", r12, "\n")

```

```{r}
# Udtr√¶k de f√∏rste 3 observationer (Snout og V√¶gt)
X <- as.matrix(T6.19[1:3, 1:2])
x_bar <- colMeans(X)
Ones <- rep(1, 3)

# Afvigelsesmatrix: Y = X - 1 * x_bar^T
Y <- X - Ones %*% t(x_bar)

# Udtr√¶k kolonner
Y1 <- Y[,1]  # Snout
Y2 <- Y[,2]  # V√¶gt

# Plot setup
plot(NA, xlim = range(c(0, Y1)), ylim = range(c(0, Y2)),
     xlab = "Snout deviation", ylab = "V√¶gt deviation",
     main = "Afvigelsesvektorer fra origo (2D)", asp = 1)
grid()

# Tegn vektorer fra origo (0,0)
arrows(0, 0, Y1[1], Y2[1], col = "red", lwd = 2)
arrows(0, 0, Y1[2], Y2[2], col = "blue", lwd = 2)
arrows(0, 0, Y1[3], Y2[3], col = "darkgreen", lwd = 2)

# Tilf√∏j labels
text(Y1[1], Y2[1], labels = "Y1", pos = 4, col = "red")
text(Y1[2], Y2[2], labels = "Y2", pos = 4, col = "blue")
text(Y1[3], Y2[3], labels = "Y3", pos = 4, col = "darkgreen")

```






## 3. Dekomponering af snout og v√¶gt

```{r}
# Udtr√¶k de f√∏rste 5 observationer for hver k√∏n
T6.19_5Huns <- T6.19[T6.19$K√∏n == "Hun", ][1:5, 1:2]
T6.19_5Hans   <- T6.19[T6.19$K√∏n == "Han",   ][1:5, 1:2]

# Kombiner i √©n matrix (2 r√¶kker, 5 kolonner pr variabel)
snout_matrix <- rbind(
  T6.19_5Hans$`Snude vent l√¶ngde (cm)`,
  T6.19_5Huns$`Snude vent l√¶ngde (cm)`
)
rownames(snout_matrix) <- c("Han", "Hun")

V√¶gt_matrix <- rbind(
  T6.19_5Hans$`V√¶gt (kg)`,
  T6.19_5Huns$`V√¶gt (kg)`
)
rownames(V√¶gt_matrix) <- c("Han", "Hun")

# Midler
snout_mean <- matrix(rep(mean(snout_matrix), 10), nrow = 2, byrow = TRUE)
rownames(snout_mean) <- c("Han", "Hun")

V√¶gt_mean <- matrix(rep(mean(V√¶gt_matrix), 10), nrow = 2, byrow = TRUE)
rownames(V√¶gt_mean) <- c("Han", "Hun")

# Treatment effect
snout_group_means <- matrix(c(rep(mean(snout_matrix[1, ]), 5),
                              rep(mean(snout_matrix[2, ]), 5)),
                            nrow = 2, byrow = TRUE)
rownames(snout_group_means) <- c("Han", "Hun")
snout_treatment <- snout_group_means - snout_mean
rownames(snout_treatment) <- c("Han", "Hun")

V√¶gt_group_means <- matrix(c(rep(mean(V√¶gt_matrix[1, ]), 5),
                               rep(mean(V√¶gt_matrix[2, ]), 5)),
                             nrow = 2, byrow = TRUE)
rownames(V√¶gt_group_means) <- c("Han", "Hun")
V√¶gt_treatment <- V√¶gt_group_means - V√¶gt_mean
rownames(V√¶gt_treatment) <- c("Han", "Hun")

# Residual
snout_residual <- snout_matrix - snout_group_means
rownames(snout_residual) <- c("Han", "Hun")

V√¶gt_residual <- V√¶gt_matrix - V√¶gt_group_means
rownames(V√¶gt_residual) <- c("Han", "Hun")

# Vis resultat for Snout
cat("Snout Vent Length:\n\n")
cat("Original data:\n"); print(snout_matrix)
cat("\nMean component:\n"); print(snout_mean)
cat("\nTreatment effect:\n"); print(snout_treatment)
cat("\nResidual:\n"); print(snout_residual)

```

```{r}
# Vis resultat for V√¶gt
cat("\n\nV√¶gt:\n\n")
cat("Original data:\n"); print(V√¶gt_matrix)
cat("\nMean component:\n"); print(V√¶gt_mean)
cat("\nTreatment effect:\n"); print(V√¶gt_treatment)
cat("\nResidual:\n"); print(V√¶gt_residual)

```

```{r}
# Som plot

library(tidyr)
library(dplyr)
library(ggplot2)

# ID og k√∏n
ID <- paste0("Obs", 1:10)
K√∏n <- c(rep("Han", 5), rep("Hun", 5))

# R√¶kkef√∏lgebevarende faktor
ID <- factor(ID, levels = paste0("Obs", 1:10))

# ----- Snout -----
df_snout <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(snout_mean),
  Treatment = as.vector(snout_treatment),
  Residual = as.vector(snout_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value")

# ----- V√¶gt -----
df_V√¶gt <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(V√¶gt_mean),
  Treatment = as.vector(V√¶gt_treatment),
  Residual = as.vector(V√¶gt_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value")

# ----- Plot Snout -----
ggplot(df_snout, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  ggtitle("Dekomponering af Snout (Length)") +
  ylab("cm") +
  theme_minimal()

# ----- Plot V√¶gt -----
ggplot(df_V√¶gt, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  ggtitle("Dekomponering af V√¶gt") +
  ylab("kg") +
  theme_minimal()

```

```{r}
library(tidyr)
library(dplyr)
library(ggplot2)

# ID og k√∏n
ID <- paste0("Obs", 1:10)
K√∏n <- c(rep("Han", 5), rep("Hun", 5))
ID <- factor(ID, levels = paste0("Obs", 1:10))  # R√¶kkef√∏lge

# ----- Snout -----
df_snout <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(snout_mean),
  Treatment = as.vector(snout_treatment),
  Residual = as.vector(snout_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value") %>%
  mutate(Component = factor(Component, levels = c("Mean", "Treatment", "Residual")))

# ----- V√¶gt -----
df_V√¶gt <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(V√¶gt_mean),
  Treatment = as.vector(V√¶gt_treatment),
  Residual = as.vector(V√¶gt_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value") %>%
  mutate(Component = factor(Component, levels = c("Mean", "Treatment", "Residual")))

# ----- Plot Snout -----
ggplot(df_snout, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Value, 1)),
            position = position_stack(vjust = 0.5),
            size = 3, color = "black") +
  scale_fill_manual(values = c("Mean" = "#F8766D", "Treatment" = "#619CFF", "Residual" = "#00BA38")) +
  ggtitle("Dekomponering af Snout (Length)") +
  ylab("cm") +
  theme_minimal()

# ----- Plot V√¶gt -----
ggplot(df_V√¶gt, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Value, 1)),
            position = position_stack(vjust = 0.5),
            size = 3, color = "black") +
  scale_fill_manual(values = c("Mean" = "#F8766D", "Treatment" = "#619CFF", "Residual" = "#00BA38")) +
  ggtitle("Dekomponering af V√¶gt") +
  ylab("kg") +
  theme_minimal()

```




```{r}
# Tilf√∏j K√∏n label
K√∏n <- c(rep("Hun", 5), rep("Han", 5))

# Dataframes til snout
df_snout <- data.frame(
  ID = factor(paste0("Obs", 1:10), levels = paste0("Obs", 1:10)),
  K√∏n = K√∏n,
  Mean = as.vector(snout_mean),
  Treatment = as.vector(snout_treatment),
  Residual = as.vector(snout_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value")

# Dataframes til V√¶gt
df_V√¶gt <- data.frame(
  ID = factor(paste0("Obs", 1:10), levels = paste0("Obs", 1:10)),
  K√∏n = K√∏n,
  Mean = as.vector(V√¶gt_mean),
  Treatment = as.vector(V√¶gt_treatment),
  Residual = as.vector(V√¶gt_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value")

# ----- Plot Snout (med k√∏n i farve) -----
ggplot(df_snout, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  facet_wrap(~K√∏n, scales = "free_x") +
  ggtitle("Dekomponering af Snout (Length) opdelt efter k√∏n") +
  ylab("cm") +
  theme_minimal()

# ----- Plot V√¶gt (med k√∏n i farve) -----
ggplot(df_V√¶gt, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  facet_wrap(~K√∏n, scales = "free_x") +
  ggtitle("Dekomponering af V√¶gt opdelt efter k√∏n") +
  ylab("kg") +
  theme_minimal()

```

```{r}
library(tidyr)
library(dplyr)
library(ggplot2)

# Tilf√∏j K√∏n label
K√∏n <- c(rep("Hun", 5), rep("Han", 5))
ID <- factor(paste0("Obs", 1:10), levels = paste0("Obs", 1:10))

# ---- SNOUT ----
df_snout <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(snout_mean),
  Treatment = as.vector(snout_treatment),
  Residual = as.vector(snout_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value") %>%
  mutate(Component = factor(Component, levels = c("Mean", "Treatment", "Residual")))

# ---- V√¶gt ----
df_V√¶gt <- data.frame(
  ID = ID,
  K√∏n = K√∏n,
  Mean = as.vector(V√¶gt_mean),
  Treatment = as.vector(V√¶gt_treatment),
  Residual = as.vector(V√¶gt_residual)
) %>%
  pivot_longer(cols = c("Mean", "Treatment", "Residual"),
               names_to = "Component", values_to = "Value") %>%
  mutate(Component = factor(Component, levels = c("Mean", "Treatment", "Residual")))

# ---- Farver ----
custom_colors <- c("Mean" = "#F8766D", "Treatment" = "#619CFF", "Residual" = "#00BA38")

# ---- Plot SNOUT ----
ggplot(df_snout, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Value, 1)),
            position = position_stack(vjust = 0.5),
            size = 3, color = "black") +
  facet_wrap(~K√∏n, scales = "free_x") +
  scale_fill_manual(values = custom_colors) +
  ggtitle("Dekomponering af Snout (Length) opdelt efter k√∏n") +
  ylab("cm") +
  theme_minimal()

# ---- Plot V√¶gt ----
ggplot(df_V√¶gt, aes(x = ID, y = Value, fill = Component)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Value, 1)),
            position = position_stack(vjust = 0.5),
            size = 3, color = "black") +
  facet_wrap(~K√∏n, scales = "free_x") +
  scale_fill_manual(values = custom_colors) +
  ggtitle("Dekomponering af V√¶gt opdelt efter k√∏n") +
  ylab("kg") +
  theme_minimal()

```



## 4. Multivariat inferens
(Hotelling‚Äôs T¬≤ test: H‚ÇÄ: Œº_Hun = Œº_Han)


4.1 Hotelling‚Äôs T¬≤ test
* **Hotelling‚Äôs T¬≤ test** for forskel i middelvektor:

  * $H_0: \mu_{\text{Hun}} = \mu_{\text{Han}}$
  * $H_A: \mu_{\text{Hun}} \ne \mu_{\text{Han}}$
* Hvis signifikant ‚Üí forts√¶t med simultane CI‚Äôer


```{r}
# Udtr√¶k data for hver gruppe (kun numeriske kolonner)
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]  # Snout og V√¶gt
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]

# Gruppest√∏rrelser
n1 <- nrow(Xf)
n2 <- nrow(Xm)
p <- ncol(Xf)  # Antal variable

# Gruppemiddelv√¶rdier
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)

# Pooled kovariansmatrix
S1 <- cov(Xf)
S2 <- cov(Xm)
Spooled <- ((n1 - 1)*S1 + (n2 - 1)*S2)/(n1 + n2 - 2)

# Hotelling‚Äôs T¬≤ testst√∏rrelse
T2 <- (n1 * n2) / (n1 + n2) * t(xbar1 - xbar2) %*% solve(Spooled) %*% (xbar1 - xbar2)

# Kritisk v√¶rdi og p-v√¶rdi
F_crit <- ((n1 + n2 - 2) * p / (n1 + n2 - p - 1)) * qf(0.95, p, n1 + n2 - p - 1)
F_val <- ((n1 + n2 - p - 1) * T2) / ((n1 + n2 - 2) * p)
p_val <- 1 - pf(F_val, p, n1 + n2 - p - 1)

# Udskriv resultat
cat("Hotelling‚Äôs T¬≤ test:\n")
cat("T¬≤ =", round(T2, 4), "\n")
cat("F =", round(F_val, 4), "\n")
cat("p-v√¶rdi =", format.pval(p_val, digits = 5), "\n")

```

Hotelling‚Äôs T¬≤ test unders√∏ger, om der er en samlet forskel i middelvektorerne for Snout Length og V√¶gt mellem hunner og hanner.

    Da p-v√¶rdien er ekstremt lav (p ‚â™ 0.05), forkaster vi nulhypotesen H‚ÇÄ: Œº_Hun = Œº_Han.

    Konklusion: Der er en signifikant multivariat forskel p√• l√¶ngde og v√¶gt mellem de to k√∏n.




4.2 Generaliseret stikpr√∏vevarians (|S|)

# Generaliseret stikpr√∏vevarians (|S|) for poolet kovariansmatrix

### Total Spredning i Flere Dimensioner (|S|)
### Multivariat Spredning: Determinant af Spooled
### kovariansstruktur: Generaliseret Varians
### Determinant af Spooled Matrix ‚Äì M√•l for Multivariat Spredning
### |S| som M√•l for Volumen af Dataspredning

(relevant for Hotelling's T¬≤ og Mahalanobis-afstand)

```{r}
# 1. Generaliseret stikpr√∏vevarians for pooled matrix
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]
n1 <- nrow(Xf); n2 <- nrow(Xm)
S1 <- cov(Xf); S2 <- cov(Xm)
Spooled <- ((n1 - 1)*S1 + (n2 - 1)*S2)/(n1 + n2 - 2)

# Determinant = generaliseret varians
gen_var <- det(Spooled)
cat("Generaliseret stikpr√∏vevarians (|S|):", round(gen_var, 4))

```

Fortolkning

# Ekstra fortolkning til posteren:
```{r}
cat("\n|S| udtrykker den samlede multivariate variation og volumen i datas√¶ttet.\n",
    "En h√∏j v√¶rdi indikerer stor spredning i b√•de l√¶ngde og v√¶gt.\n")

```





|S| udtrykker den samlede multivariate variation og volumen i datas√¶ttet. En h√∏j v√¶rdi indikerer stor spredning i b√•de l√¶ngde og v√¶gt.


```{r}
cat("Generaliseringen |S| = |D| ‚ãÖ |R| viser, at varians og korrelation sammen bestemmer spredningens volumen.\n")
```



```{r}

cat("Bem√¶rk: Determinanten af Spooled-matrixen fungerer som en generaliseret stikpr√∏vevarians.\n",
    "En lav v√¶rdi tyder p√• h√∏j korrelation mellem variablerne, mens en h√∏j v√¶rdi tyder p√• st√∏rre uafh√¶ngighed.\n")
```

|S| m√•ler samlet spredning. Lav v√¶rdi ‚Üí h√∏j korrelation. H√∏j v√¶rdi ‚Üí st√∏rre uafh√¶ngighed.





4.3 Visualisering: Hotelling‚Äôs T¬≤-ellipse


```{r}
#Grafisk med ellipse pakken

library(ellipse)

# Brug Spooled og center i forskellen mellem k√∏n
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)
diff_mean <- xbar1 - xbar2

n1 <- nrow(Xf); n2 <- nrow(Xm)
Spooled <- ((n1 - 1)*cov(Xf) + (n2 - 1)*cov(Xm))/(n1 + n2 - 2)
n <- (n1 * n2) / (n1 + n2)
alpha <- 0.05
p <- 2
T2_crit <- ((n1 + n2 - 2) * p / (n1 + n2 - p - 1)) * qf(1 - alpha, p, n1 + n2 - p - 1)

# Plot
plot(ellipse(Spooled / n, centre = diff_mean, level = 1 - alpha,
             t = sqrt(T2_crit)), type = "l", col = "darkblue",
     xlab = "Snude vent l√¶ngde (cm)", ylab = "V√¶gt (kg)",
     main = "Hotelling‚Äôs T¬≤ Ellipse (Volumen ‚âà |S|)")
points(0, 0, pch = 4, col = "red")
text(0, 0, "0", pos = 1, cex = 0.8)

```

```{r}
# Grafisk uden ellipse pakken
# Parametre
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)
diff_mean <- xbar1 - xbar2
n <- (n1 * n2) / (n1 + n2)
alpha <- 0.05
p <- 2
T2_crit <- ((n1 + n2 - 2) * p / (n1 + n2 - p - 1)) * qf(1 - alpha, p, n1 + n2 - p - 1)

# Gener√©r ellipse uden ellipse-pakke
theta <- seq(0, 2*pi, length.out = 200)
circle <- cbind(cos(theta), sin(theta))
A <- chol(Spooled / n * T2_crit)
ellipse_coords <- t(diff_mean + t(circle %*% A))

# Plot
plot(ellipse_coords, type = "l", lwd = 2, col = "black",
     xlab = "Snude vent l√¶ngde (cm)", ylab = "V√¶gt (kg)",
     main = "Hotelling‚Äôs T¬≤ Ellipse (uden ellipse-pakke)")
points(0, 0, col = "blue", pch = 19)
text(0, 0, "0", pos = 1)
points(diff_mean[1], diff_mean[2], pch = 19, col = "darkblue")
#text(diff_mean[1], diff_mean[2], "M1 - M2", pos = 4, col = "darkblue")
text(diff_mean[1], diff_mean[2], expression(mu[1] - mu[2]), pos = 4, col = "darkblue")


```

üîç Punktet "M1 - M2" repr√¶senterer forskellen mellem de to gruppers stikpr√∏vegennemsnit. Hvis dette punkt falder uden for T¬≤-ellipsen, tyder det p√• en signifikant forskel i middelv√¶rdierne.


‚úÖ Kort opsummering til posteren:

    Den sorte ellipse repr√¶senterer omr√•det for ikke-signifikante differenser i middelvektorer mellem de to k√∏n.

    Da det bl√• punkt (Œº‚ÇÅ ‚àí Œº‚ÇÇ) falder uden for ellipsen, forkastes H‚ÇÄ ‚Üí der er en signifikant forskel.



**4.4 Mannova** (Simpel med wilks)
```{r}
# Multivariat variansanalyse (MANOVA)
model_manova <- manova(cbind(`Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`) ~ K√∏n, data = T6.19)

# Samlet test med summary
summary(model_manova, test = "Wilks")

```

 Kort forklaring til posteren (valgfrit)

    Der blev udf√∏rt en multivariat variansanalyse (MANOVA) for at teste, om der er en samlet forskel i l√¶ngde og v√¶gt mellem hanner og hunner.
    Wilks‚Äô lambda-test viste en meget signifikant forskel (p < 2.2e-16), hvilket bekr√¶fter resultaterne fra de univariate t-tests.
    

**4.4b Mannova med Bartletts korrektion**
```{r}
library(dplyr)

# Data: responsvariabler og grupper
Y <- T6.19[, 1:2]  # Snout & V√¶gt
group <- T6.19$K√∏n
n1 <- sum(group == "Hun")
n2 <- sum(group == "Han")
g <- 2
p <- ncol(Y)
n_total <- nrow(Y)

# Fit MANOVA-model
fit <- manova(as.matrix(Y) ~ group)

# Kort metode ‚Äì direkte Wilks-test
summary(fit, test = "Wilks")

# Lang metode ‚Äì Udtr√¶k SSCP-matricer
B <- summary(fit)$SS$group
W <- summary(fit)$SS$Residuals
T_mat <- B + W

# Frihedsgrader
df1 <- p * (g - 1)          # for behandling
df2 <- p * (n_total - g)    # for residualer

# Wilks' lambda
lambda <- det(W) / det(T_mat)

# Chi-i-anden Bartletts korrektion (Resultat 6.8 / 6.43)
m <- (n1 + n2 - 2) - (p + g) / 2
chi2_stat <- -m * log(lambda)
chi2_crit <- qchisq(0.95, df1)
pval_chi2 <- pchisq(chi2_stat, df1, lower.tail = FALSE)

# Udskriv resultater
cat("Wilks‚Äô lambda: ", round(lambda, 4), "\n")
cat("Chi¬≤-test (Bartletts korrektion):\n")
cat("Teststatistik:", round(chi2_stat, 3), "\n")
cat("Kritisk v√¶rdi (œá¬≤, 95%, df =", df1, "):", round(chi2_crit, 3), "\n")
cat("p-v√¶rdi:", signif(pval_chi2, 4), "\n")
cat("Konklusion: ", ifelse(pval_chi2 < 0.05, "Forkast H‚ÇÄ ‚Äì K√∏n p√•virker mindst √©n af variablerne.", "Forkast ikke H‚ÇÄ ‚Äì Ingen forskel."), "\n")

```

üìå MANOVA-resultat (ud fra Bartletts korrektion)

    Wilks‚Äô Œª = 0.4125

    œá¬≤ = 46.05, kritisk œá¬≤ = 5.99, df = 2

    p < 0.0000000001

‚úÖ Konklusion:
Forkast H‚ÇÄ ‚Äî k√∏n har signifikant indflydelse p√• mindst √©n af variablerne (Snout Length eller V√¶gt).


SAmlet konklusion p√• MANNVA:


üìå Kort fortolkning til posteren (tekst)

    MANOVA: Multivariat variansanalyse

    Unders√∏ger om middelvektorerne for Snout Length og V√¶gt er ens mellem hunner og hanner:

        H‚ÇÄ: Œº<sub>Hun</sub> = Œº<sub>Han</sub>

        H‚ÇÅ: Œº<sub>Hun</sub> ‚â† Œº<sub>Han</sub>

    Resultat:

        Wilks‚Äô Œª = 0.4125

        F(2, 53) = 37.745, p < 0.0000000001

        œá¬≤ = 46.05, kritisk œá¬≤ = 5.99, df = 2

        p < 0.0000000001

    ‚úÖ Begge tests f√∏rer til samme konklusion:
    Forkast H‚ÇÄ ‚Äî k√∏n p√•virker signifikant mindst √©n af variablerne (snout eller v√¶gt eller begge).
    
    
    
    
    


## 5.  Test for kovariansmatricer (Box‚Äôs M test)


```{r}
# Box‚Äôs M test for lighed i kovariansmatricer

# Foruds√¶t: T6.19 har kolonner: Snude vent l√¶ngde (cm), V√¶gt (kg), K√∏n
library(dplyr)

# Del op efter k√∏n
Xf <- T6.19 %>%
  filter(K√∏n == "Hun") %>%
  dplyr::select(`Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`)

Xm <- T6.19 %>%
  filter(K√∏n == "Han") %>%
  dplyr::select(`Snude vent l√¶ngde (cm)`, `V√¶gt (kg)`)


n1 <- nrow(Xf)
n2 <- nrow(Xm)
p <- ncol(Xf)
g <- 2
n_total <- n1 + n2

# Kovariansmatricer
S1 <- cov(Xf)
S2 <- cov(Xm)

# Determinanter
detS1 <- det(S1)
detS2 <- det(S2)

# Spooled
Spooled <- ((n1 - 1) * S1 + (n2 - 1) * S2) / (n_total - g)
detSpooled <- det(Spooled)

# Box's M test statistik
M <- (n1 - 1) * log(detSpooled / detS1) + (n2 - 1) * log(detSpooled / detS2)

# Korrektionsfaktor
u <- ((1 / (n1 - 1)) + (1 / (n2 - 1)) - (1 / (n_total - g))) *
     (2 * p^2 + 3 * p - 1) / (6 * (p + 1) * (g - 1))

C <- (1 - u) * M
df <- p * (p + 1) * (g - 1) / 2
pval <- pchisq(C, df, lower.tail = FALSE)

# Resultat
cat("Box‚Äôs M test:\n")
cat("Teststatistik:", round(C, 3), "\n")
cat("Frihedsgrader:", df, "\n")
cat("p-v√¶rdi:", signif(pval, 4), "\n")
cat("Konklusion: ", ifelse(pval < 0.05,
                          "Forkast H‚ÇÄ ‚Äì kovariansmatricerne er forskellige.",
                          "Forkast ikke H‚ÇÄ ‚Äì antag ens kovariansmatricer."), "\n")


```
üìå 2. Fortolkning til posteren (Box‚Äôs M-test)

Box‚Äôs M-test unders√∏ger, om varians-/kovariansstrukturen er ens mellem grupperne ‚Äî her: hunner og hanner.
Hypoteser:

    H‚ÇÄ: Kovariansmatricerne for de to k√∏n er ens

    H‚ÇÅ: Mindst √©n gruppe har en anden kovariansstruktur

Resultat:

    Teststatistik: 100.325

    Frihedsgrader: 3

    p-v√¶rdi: < 0.0000000000000000000014

‚úÖ Konklusion: Da p-v√¶rdien er langt under 0.05, forkastes H‚ÇÄ.
Der er signifikant forskel i kovariansmatricerne ‚Äî dvs. variabiliteten i l√¶ngde og v√¶gt varierer mellem hunner og hanner.








## 6. Simultane konfidensintervaller
(Ellipse + Bonferroni CI)


```{r}
library(MASS)

# Del data
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]

# Parametre
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)
diff_mean <- xbar1 - xbar2
n1 <- nrow(Xf); n2 <- nrow(Xm)
p <- ncol(Xf)
n <- (n1 * n2) / (n1 + n2)
Spooled <- ((n1 - 1)*cov(Xf) + (n2 - 1)*cov(Xm)) / (n1 + n2 - 2)

# Kritiske v√¶rdier
alpha <- 0.05
t_crit <- qt(1 - alpha/(2*p), df = n1 + n2 - 2)  # Bonferroni
T2_crit <- ((n1 + n2 - 2)*p / (n1 + n2 - p - 1)) * qf(1 - alpha, p, n1 + n2 - p - 1)  # T¬≤

# Bonferroni-interval (rektangel)
margin <- t_crit * sqrt(diag(Spooled) / n)
rect_coords <- rbind(
  diff_mean + c(-margin[1], -margin[2]),
  diff_mean + c( margin[1], -margin[2]),
  diff_mean + c( margin[1],  margin[2]),
  diff_mean + c(-margin[1],  margin[2]),
  diff_mean + c(-margin[1], -margin[2])
)

# T¬≤-ellipse
theta <- seq(0, 2*pi, length.out = 200)
circle <- cbind(cos(theta), sin(theta))
A <- chol(Spooled / n * T2_crit)
ellipse_coords <- t(diff_mean + t(circle %*% A))

# Plot
plot(ellipse_coords, type = "l", col = "blue", lwd = 2,
     xlab = "Snude vent l√¶ngde (cm)", ylab = "V√¶gt (kg)")
     #main = "Konfidensellipse (T¬≤) og Bonferroni-rektangel")
     #xlim = c(0, 155),
     #ylim = c(0, 45))
lines(rect_coords, col = "red", lty = 2, lwd = 2)
points(0, 0, pch = 4, col = "black")
text(0, 0, "0", pos = 1)
points(diff_mean[1], diff_mean[2], col = "blue", pch = 19)
text(diff_mean[1], diff_mean[2], expression(mu[1] - mu[2]), pos = 4, cex = 0.8)
legend("topleft", legend = c("Hotelling‚Äôs T¬≤", "Bonferroni"),
       col = c("blue", "red"), lty = c(1, 2), lwd = 2)

grid()

```
```{r}
library(MASS)

# Del data
Xf <- T6.19[T6.19$K√∏n == "Hun", 1:2]
Xm <- T6.19[T6.19$K√∏n == "Han", 1:2]

# Parametre
xbar1 <- colMeans(Xf)
xbar2 <- colMeans(Xm)
diff_mean <- xbar1 - xbar2
n1 <- nrow(Xf); n2 <- nrow(Xm)
p <- ncol(Xf)
n <- (n1 * n2) / (n1 + n2)
Spooled <- ((n1 - 1)*cov(Xf) + (n2 - 1)*cov(Xm)) / (n1 + n2 - 2)

# Kritiske v√¶rdier
alpha <- 0.05
t_crit <- qt(1 - alpha/(2*p), df = n1 + n2 - 2)  # Bonferroni
T2_crit <- ((n1 + n2 - 2)*p / (n1 + n2 - p - 1)) * qf(1 - alpha, p, n1 + n2 - p - 1)  # T¬≤

# Bonferroni-interval (rektangel)
margin <- t_crit * sqrt(diag(Spooled) / n)
rect_coords <- rbind(
  diff_mean + c(-margin[1], -margin[2]),
  diff_mean + c( margin[1], -margin[2]),
  diff_mean + c( margin[1],  margin[2]),
  diff_mean + c(-margin[1],  margin[2]),
  diff_mean + c(-margin[1], -margin[2])
)

# T¬≤-ellipse
theta <- seq(0, 2*pi, length.out = 200)
circle <- cbind(cos(theta), sin(theta))
A <- chol(Spooled / n * T2_crit)
ellipse_coords <- t(diff_mean + t(circle %*% A))

# Beregn konfidensintervaller
bonf_bounds <- rbind(
  diff_mean - margin,
  diff_mean + margin
)
ellipse_x <- range(ellipse_coords[, 1])
ellipse_y <- range(ellipse_coords[, 2])

# Plot
plot(ellipse_coords, type = "l", col = "blue", lwd = 2,
     xlab = "Snude vent l√¶ngde (cm)", ylab = "V√¶gt (kg)",
     main = "Konfidensellipse (T¬≤) og Bonferroni-rektangel")

lines(rect_coords, col = "red", lty = 2, lwd = 2)
points(0, 0, pch = 4, col = "black")
text(0, 0, "0", pos = 1)
points(diff_mean[1], diff_mean[2], col = "blue", pch = 19)
text(diff_mean[1], diff_mean[2], expression(mu[1] - mu[2]), pos = 4, cex = 0.8)

# Dansk legende med intervaller
legend_text <- c(
  "Hotellings T¬≤",
  sprintf("Snudel√¶ngde: [%.1f ; %.1f]", ellipse_x[1], ellipse_x[2]),
  sprintf("V√¶gt: [%.1f ; %.1f]", ellipse_y[1], ellipse_y[2]),
  "",
  "Bonferroni",
  sprintf("Snudel√¶ngde: [%.1f ; %.1f]", bonf_bounds[1,1], bonf_bounds[2,1]),
  sprintf("V√¶gt: [%.1f ; %.1f]", bonf_bounds[1,2], bonf_bounds[2,2])
)

legend("topleft", legend = legend_text,
       col = c("blue", NA, NA, NA, "red", NA, NA),
       lty = c(1, NA, NA, NA, 2, NA, NA),
       lwd = c(2, NA, NA, NA, 2, NA, NA),
       bty = "n", cex = 0.8)

grid()

```



üß† 2. Fortolkning ‚Äì til posteren

üìå Konfidensellipse og -rektangel

    Vi sammenligner forskellen mellem hunner og hanner ift. b√•de l√¶ngde og v√¶gt.

    To konfidensomr√•der vises:

        üîµ Ellipse (Hotelling‚Äôs T¬≤): Multivariat konfidensomr√•de

        üî∫ Rektangel (Bonferroni CI): To separate simultane konfidensintervaller

    0,0-punktet repr√¶senterer ingen forskel mellem k√∏nnene.

    Da b√•de ellipse og rektangel ikke indeholder 0,0 ‚Üí vi har st√¶rk evidens for forskel i mindst √©n variabel.




## 7. Konklusion og fortolkning


üìå Diskussion og konklusioner

Gennem b√•de univariate og multivariate analyser fandt vi klare tegn p√•, at k√∏n har signifikant indflydelse p√• b√•de Snout Length og V√¶gt hos anacondaerne.

    T-tests viste signifikante forskelle i b√•de l√¶ngde og v√¶gt mellem hunner og hanner (p ‚â™ 0.05).

    Violinplots og boxplots underst√∏ttede disse resultater visuelt med tydelig adskillelse mellem k√∏nnene.

    Hotelling‚Äôs T¬≤-test og MANOVA bekr√¶ftede, at forskellen i middelvektorer er signifikant (Wilks' Œª = 0.4125, p < 0.0000000001).

    Simultane konfidensintervaller (Bonferroni og T¬≤-ellipse) viste begge, at nulpunktet (0,0) ikke ligger inde i intervallerne ‚Üí dvs. vi kan med h√∏j sikkerhed afvise, at der ikke er forskel.

    Box‚Äôs M-test viste, at variansen og kovariansstrukturen ikke er ens mellem k√∏nnene (p < 0.000000000001), hvilket understreger forskellene yderligere.

üîç Overordnet set konkluderer vi:

    Der er statistisk bel√¶g for, at k√∏n har en signifikant effekt p√• b√•de l√¶ngde og v√¶gt hos anacondaerne, og denne effekt ses b√•de i gennemsnit, variation og kovariansstruktur.

Disse resultater b√∏r tages i betragtning i biologisk forskning, fx ved artsopdeling, v√¶kststudier eller populationsanalyse.



