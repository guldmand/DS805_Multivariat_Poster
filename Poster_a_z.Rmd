---
title: "Anaconda Project – Path 1 (Inferens)"
author: "Sabine Christoffersen & Jannik Guldmand"
date: "2025-05-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Load and Prepare Data

```{r}
library(st514)
data("T6-19")
T6.19 <- tbl
colnames(T6.19) <- c("Snout Vent Length (cm)", "Weight (kg)", "Gender")
levels(T6.19$Gender) <- c("Female", "Male")
```

## 2. Exploratory Data Analysis (EDA)

```{r}
dim(T6.19)
str(T6.19)
summary(T6.19)
```

### Boxplots
```{r}
boxplot(`Snout Vent Length (cm)` ~ Gender, data = T6.19, main = "Length by Gender")
boxplot(`Weight (kg)` ~ Gender, data = T6.19, main = "Weight by Gender")
```

### Scatterplot Matrix
```{r}
pairs(T6.19[, 1:2], col = T6.19$Gender, pch = 19)
```

### QQ-plots (Univariate)
```{r}
qqnorm(T6.19$`Snout Vent Length (cm)`[T6.19$Gender == "Female"])
qqline(T6.19$`Snout Vent Length (cm)`[T6.19$Gender == "Female"])
qqnorm(T6.19$`Weight (kg)`[T6.19$Gender == "Female"])
qqline(T6.19$`Weight (kg)`[T6.19$Gender == "Female"])
qqnorm(T6.19$`Snout Vent Length (cm)`[T6.19$Gender == "Male"])
qqline(T6.19$`Snout Vent Length (cm)`[T6.19$Gender == "Male"])
qqnorm(T6.19$`Weight (kg)`[T6.19$Gender == "Male"])
qqline(T6.19$`Weight (kg)`[T6.19$Gender == "Male"])
```

### Mahalanobis Distances (Multivariate Normality)
```{r}
X <- T6.19[, 1:2]
mu <- colMeans(X)
S <- cov(X)
D2 <- mahalanobis(X, mu, S)
qqplot(qchisq(ppoints(nrow(X)), df = 2), D2,
       main = "QQ Plot of Mahalanobis Distances",
       xlab = "Theoretical Quantiles",
       ylab = "D-squared")
abline(0, 1, col = "red")
```

## 3. Univariate t-tests
```{r}
t.test(`Snout Vent Length (cm)` ~ Gender, data = T6.19, var.equal = TRUE)
t.test(`Weight (kg)` ~ Gender, data = T6.19, var.equal = TRUE)
```

## 4. Hotelling’s T² Test
```{r}
Xf <- T6.19[T6.19$Gender == "Female", 1:2]
Xm <- T6.19[T6.19$Gender == "Male", 1:2]
n1 <- nrow(Xf); n2 <- nrow(Xm)
xbar1 <- colMeans(Xf); xbar2 <- colMeans(Xm)
S1 <- cov(Xf); S2 <- cov(Xm)
Spooled <- ((n1 - 1)*S1 + (n2 - 1)*S2) / (n1 + n2 - 2)
T2 <- t(xbar1 - xbar2) %*% solve((1/n1 + 1/n2)*Spooled) %*% (xbar1 - xbar2)
p <- ncol(Xf)
Fstat <- (n1 + n2 - p - 1)*T2 / ((n1 + n2 - 2)*p)
pval <- 1 - pf(Fstat, df1 = p, df2 = n1 + n2 - p - 1)
T2; Fstat; pval
```

## 5. Box’s M Test
```{r}
library(heplots)
boxM(cbind(`Snout Vent Length (cm)`, `Weight (kg)`) ~ Gender, data = T6.19)
```

## 6. Simultane Bonferroni Confidence Intervals
```{r}
g <- 2
alpha <- 0.05
tval <- qt(1 - alpha/(2 * p), df = n1 + n2 - 2)
se_diff <- sqrt(diag((1/n1 + 1/n2)*Spooled))
diff_means <- xbar1 - xbar2
lower <- diff_means - tval * se_diff
upper <- diff_means + tval * se_diff

CI_results <- data.frame(Variable = c("Length", "Weight"),
                         Mean_Diff = diff_means,
                         Lower = lower,
                         Upper = upper)
CI_results
```

## 7. Conclusion and Interpretation

**Statistical conclusion:**
- Hotelling’s T²-test reveals a significant difference between male and female anacondas (p < 0.05).
- Bonferroni intervals suggest the difference in **length** is statistically significant (CI does not include 0), while the CI for **weight** includes 0.

**Biological interpretation:**
- Female anacondas are significantly longer than males.
- Weight difference is less certain, suggesting that length is the main contributor to sexual dimorphism in this sample.
